<implementor name="http client curl" is_default="1">
    Provide implementation based on the library LIBCURL.

    <implementation name="http client curl" scope="private">
        HTTP client based on the library LIBCURL.

        <require header="curl/curl.h" is_system="1"/>
        <require header="ctype.h" is_system="1"/>
        <require class="str buffer" project="common" api="defs"/>
        <require class="str mutable" project="common"/>
        <require class="http response" api="internal"/>


        <interface name="http client"/>


        <constant name="k header name value separator" type="string" visibility="private">
            Separator between header name and header value.

            <value value=": "/>
        </constant>


        <property name="ca bundle path" class="str mutable"/>


        <constructor name="with ca">
            Use custom CA bundle.

            <argument name="ca bundle path" class="str"/>
        </constructor>


        <method name="format header" is_static="1" declaration="private">
            Concatenate header name and header value as "NAME: VALUE".

            Note, given buffer is reset first and then strings are appended.
            Note, written string is null-terminated.

            <argument name="name" class="str"/>
            <argument name="value" class="str"/>
            <argument name="out str" class="str buffer"/>
        </method>


        <method name="write recevied data" is_static="1" declaration="private">
            Callback for CURL body writing function.

            <argument name="ptr" class="any" access="readwrite"/>
            <argument name="size" type="size"/>
            <argument name="nmemb" type="size"/>
            <argument name="body buffer" class="buffer" access="readwrite"/>

            <return type="size"/>
        </method>


        <method name="write recevied header" is_static="1" declaration="private">
            Callback for CURL header writing function.

            <argument name="ptr" type="string" access="readwrite">
                <string length="given"/>
            </argument>
            <argument name="size" type="size"/>
            <argument name="nmemb" type="size"/>
            <argument name="http response" class="http response" access="readwrite"/>

            <return type="size"/>
        </method>
    </implementation>
</implementor>
